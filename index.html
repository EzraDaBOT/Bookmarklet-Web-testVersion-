<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bookmarklet Hub</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    // --- Firebase imports ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyCKq5ZX-DMEe1wlqJGRNKt9ZGC_3MMgO1k",
      authDomain: "bookmarkletlist.firebaseapp.com",
      projectId: "bookmarkletlist",
      storageBucket: "bookmarkletlist.firebasestorage.app",
      messagingSenderId: "20442618935",
      appId: "1:20442618935:web:a3d9fad025e98a3822b3b2",
      measurementId: "G-REZK5WSKWY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const colRef = collection(db, "bookmarklets");

    const uploadForm = document.getElementById("uploadForm");
    const bookmarkletList = document.getElementById("bookmarkletList");

    async function loadBookmarklets() {
      bookmarkletList.innerHTML = "<p>Loading...</p>";
      const querySnapshot = await getDocs(colRef);
      bookmarkletList.innerHTML = "";
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${data.name}</h3>
          <p>${data.description}</p>
          <div class="btns">
            <a class="bm" href="javascript:${encodeURIComponent(data.code)}">Drag to Bookmarks</a>
            <button class="copy">Copy JS</button>
            <button class="delete">Delete</button>
          </div>
        `;
        card.querySelector(".copy").onclick = () => {
          navigator.clipboard.writeText(data.code);
          alert("Bookmarklet copied!");
        };
        card.querySelector(".delete").onclick = async () => {
          if (confirm(`Delete "${data.name}"?`)) {
            await deleteDoc(doc(db, "bookmarklets", docSnap.id));
            card.remove();
          }
        };
        bookmarkletList.appendChild(card);
      });
    }

    uploadForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = uploadForm.name.value.trim();
      const description = uploadForm.description.value.trim();
      const code = uploadForm.code.value.trim();
      if (!name || !code) return alert("Name and code are required.");

      await addDoc(colRef, { name, description, code, createdAt: Date.now() });
      uploadForm.reset();
      loadBookmarklets();
    });

    loadBookmarklets();
  </script>
</head>
<body>
  <header>
    <h1>ðŸ“š Bookmarklet Hub</h1>
    <p>Upload, share, and explore bookmarklets.</p>
  </header>

  <section id="uploadSection">
    <form id="uploadForm">
      <input type="text" name="name" placeholder="Bookmarklet name" required />
      <textarea name="description" placeholder="Description (optional)"></textarea>
      <textarea name="code" placeholder="Paste JavaScript code here..." required></textarea>
      <button type="submit">Upload</button>
    </form>
  </section>

  <section id="listSection">
    <h2>All Bookmarklets</h2>
    <div id="bookmarkletList" class="grid"></div>
  </section>
</body>
</html>
